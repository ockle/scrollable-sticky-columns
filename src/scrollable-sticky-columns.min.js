/**
 * Scrollable Sticky Columns jQuery Plugin
 * 
 * @see https://github.com/ockle/scrollable-sticky-columns
 * @version 1.0.0
 * @author github.com/ockle
 * @license MIT
 */
!function(a,b,c,d){function e(b,c){this.columns=b,this.settings=a.extend({},c),this.checkColumnsValidity(),this.assignContainer(),this.init()}e.prototype={checkColumnsValidity:function(){if(this.columns.length<2)throw"This function must be called on 2 or more elements";return this.columns.each(function(){if(a(this).data("scrollableStickyColumns")!==d)throw"Cannot call this function more than once on the same element"}),!0},assignContainer:function(){return this.container=this.settings.container!==d?this.columns.eq(0).closest(this.settings.container):this.columns.eq(0).parents().has(this.columns.eq(1)).first(),this.checkContainerValidity()},checkContainerValidity:function(){var b=this.container;if(!b.length)throw"Unable to find container";if(b.data("scrollableStickyColumns")!==d)throw"Cannot call this function more than once on the same container";return this.columns.each(function(){var c=a(this);if(!c.parents().filter(b).length)throw"The container does not contain all the selected columns";if(b.has(c.offsetParent()).length)throw"The conatiner must be the offset parent of the columns"}),!0},init:function(){return this.previousScrollTop=0,this.busy=!1,this.getDimensions(),this.setupContainer(),this.setupColumns(),a(b).on("scroll",a.proxy(this.scrollHandler,this)).trigger("scroll"),a(b).on("resize",a.proxy(this.resizeHandler,this)),this},getDimensions:function(){this.viewportHeight=a(b).height(),this.documentHeight=a(c).height()},setupContainer:function(){var a=this;this.container.data("scrollableStickyColumns",new function(){this.originalStyle=a.container.attr("style")||!1,this.height=a.container.height(),this.innerHeight=a.container.innerHeight(),this.outerHeight=a.container.outerHeight(),this.topOffset=a.container.offset().top+parseInt(a.container.css("border-top-width"),10),this.bottomOffset=a.documentHeight-this.topOffset-a.container.outerHeight()+parseInt(a.container.css("margin-bottom"),10)}),this.container.css({position:"relative",height:"border-box"==this.container.css("box-sizing")?this.container.data("scrollableStickyColumns").outerHeight:this.container.data("scrollableStickyColumns").height})},setupColumns:function(){var b=null,e=0,f=this,g=a(c).scrollTop(),h=this.container.data("scrollableStickyColumns");this.columns.each(function(){var c=a(this),g=c.outerHeight(),h=c.offset(),i=c.position();c.data("scrollableStickyColumns",new function(){this.originalStyle=c.attr("style")||!1,this.height=g,this.width="border-box"==c.css("box-sizing")?c.outerWidth():c.width(),this.marginTop=parseInt(c.css("margin-top"),10),this.marginRight=parseInt(c.css("margin-right"),10),this.marginBottom=parseInt(c.css("margin-bottom"),10),this.marginLeft=parseInt(c.css("margin-left"),10),this.topOffset=h.top-this.marginTop,this.leftOffset=h.left-this.marginLeft,this.topPosition=i.top,this.leftPosition=i.left,this.topStop=f.settings.topStop!==d?f.settings.topStop:this.topPosition,this.currentPosition="absolute",this.upSet=!0,this.downSet=!1}),(null===b||g>e)&&(b=c,e=g)}),this.nonTallest=this.columns.not(b),this.columns.each(function(){var c=a(this),g=c.data("scrollableStickyColumns");c.css({position:"absolute",left:g.leftPosition,width:g.width}),g.bottomOffset=f.documentHeight-b.data("scrollableStickyColumns").topOffset-b.outerHeight(),g.bottomStop=f.settings.bottomStop!==d?f.settings.bottomStop:h.innerHeight-e-b.data("scrollableStickyColumns").topPosition,g.bottomStop+=Math.max(0,f.viewportHeight-g.topStop-g.bottomStop-g.height)}),this.nonTallest.each(function(){var b=a(this),c=b.data("scrollableStickyColumns");f.viewportHeight+g-c.bottomStop+c.marginTop>f.documentHeight-c.bottomOffset&&b.css({top:f.documentHeight-c.bottomOffset-h.topOffset-c.height})})},scrollHandler:function(){var b=this;if(!this.busy){this.busy=!0;var d=a(c).scrollTop(),e=this.container.data("scrollableStickyColumns");this.nonTallest.each(function(){var c=a(this),f=c.data("scrollableStickyColumns"),g=parseInt(c.offset().top,10);d>b.previousScrollTop?b.viewportHeight+d-f.bottomStop-f.marginTop>b.documentHeight-f.bottomOffset&&"fixed"==f.currentPosition?(c.css({position:"absolute",top:b.documentHeight-f.bottomOffset-e.topOffset-f.height,left:f.leftPosition}),f.currentPosition="absolute",f.upSet=!1,c.trigger("reachedBottomOfContainer.scrollableStickyColumns")):g+f.height<b.viewportHeight+d-f.bottomStop&&b.documentHeight-f.bottomOffset+f.marginTop>b.viewportHeight+d-f.bottomStop&&"fixed"!=f.currentPosition?(c.css({position:"fixed",top:b.viewportHeight-f.height-f.bottomStop-f.marginTop,left:f.leftOffset}),f.currentPosition="fixed",f.upSet=!1,c.trigger("stuckToBottom.scrollableStickyColumns")):f.downSet||(c.css({position:"absolute",top:g-e.topOffset-f.marginTop,left:f.leftPosition}),f.currentPosition="absolute",f.downSet=!0,c.trigger("unstuckFromTop.scrollableStickyColumns")):d<b.previousScrollTop&&(f.upSet?f.topOffset<d+f.topStop-f.marginTop&&g>d+f.topStop&&"fixed"!=f.currentPosition?(c.css({position:"fixed",top:f.topStop-f.marginTop,left:f.leftOffset}),f.currentPosition="fixed",f.downSet=!1,c.trigger("stuckToTop.scrollableStickyColumns")):d+f.topStop-f.marginTop<f.topOffset&&"fixed"==f.currentPosition&&(c.css({position:"absolute",top:f.topOffset-e.topOffset,left:f.leftPosition}),f.currentPosition="absolute",f.downSet=!1,c.trigger("reachedTopOfContainer.scrollableStickyColumns")):(c.css({position:"absolute",top:g-e.topOffset-f.marginTop,left:f.leftPosition}),f.currentPosition="absolute",f.upSet=!0,c.trigger("unstuckFromBottom.scrollableStickyColumns")))}),this.previousScrollTop=d,this.busy=!1}},resizeHandler:function(){this.remove().init()},remove:function(){return a(b).off("scroll",this.scrollHandler),a(b).off("resize",this.resizeHandler),this.container.attr("style",this.container.data("scrollableStickyColumns").originalStyle),this.columns.each(function(){var b=a(this);b.attr("style",b.data("scrollableStickyColumns").originalStyle)}),this}},a.fn.scrollableStickyColumns=function(a){return new e(this,a)}}(jQuery,window,document);